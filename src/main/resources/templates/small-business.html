<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Business View</title>
    <link rel="stylesheet" href="../static/student.css" >
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
<div id="navbar-container"></div>
<div id="content">
    <div class="input-group mb-3">
        <input type="text" id="search-bar" class="form-control" placeholder="Search Business by Name" aria-label="Search Business">
    </div>

    <div id="buttons">
        <button type="button" class="btn btn-primary" id="delete-btn">Delete Business</button>
        <button type="button" class="btn btn-primary" id="restrict-btn">Restrict Business</button>
        <button type="button" class="btn btn-primary" id="unrestrict-btn">Unrestrict Business</button>
        <button type="button" class="btn btn-primary" id="expand-form-btn" data-bs-toggle="collapse" data-bs-target="#add-business-form">Add Business</button>
    </div>
    <div class="collapse" id="add-business-form">
        <form>
            <div class="form-group">
                <label for="business-name">Business Name</label>
                <input type="text" class="form-control" id="business-name" aria-describedby="emailHelp" placeholder="Enter business name">
            </div>
            <div class="form-group">
                <label for="business-owner">Owner Name</label>
                <input type="text" class="form-control" id="business-owner" placeholder="John Doe" required>
            </div>
            <div class="form-group">
                <label for="business-id">Business ID</label>
                <input type="text" class="form-control" id="business-id" placeholder="@xyz" required>
            </div>
            <button type="submit" class="btn btn-success">Submit</button>
        </form>
    </div>
    <div id="list-students">
        <table class="table">
            <thead class="thead-dark">
            <tr>
                <th scope="col">#</th>
                <th scope="col">Name</th>
                <th scope="col">Owner</th>
                <th scope="col">ID</th>
                <th scope="col">Status</th>

            </tr>
            </thead>
            <tbody id="table-body">
            <tr data-name="Spartan Cooks">
                <th scope="row">1</th>
                <td>Spartan Cooks</td>
                <td>Otto</td>
                <td>@mdo</td>
                <td><span class="status">Active</span></td>
            </tr>
            <tr data-name="Target">
                <th scope="row">2</th>
                <td>Target</td>
                <td>Thornton</td>
                <td>@fat</td>
                <td><span class="status">Active</span></td>

            </tr>
            <tr data-name="Walmart">
                <th scope="row">3</th>
                <td>Walmart</td>
                <td>the Bird</td>
                <td>@twitter</td>
                <td><span class="status">Active</span></td>

            </tr>
            </tbody>
        </table>

    </div>


</div>

<!-- Bootstrap JS -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    fetch('navbar.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('navbar-container').innerHTML = data;
        })
        .catch(error => console.error('Error loading navbar:', error));  // To catch any fetch errors
    //for filtering table rows
    document.getElementById('search-bar').addEventListener('input', function () {
        let filter = this.value.toLowerCase();
        let rows = document.querySelectorAll('#table-body tr');
        rows.forEach(row => {
            let nameCell = row.cells[1].textContent.toLowerCase();
            if (nameCell.includes(filter)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });

    //deleting a business
    document.getElementById('delete-btn').addEventListener('click', function () {
        let searchValue = document.getElementById('search-bar').value.toLowerCase();
        let rows = document.querySelectorAll('#table-body tr');
        let deleted = false;

        rows.forEach(row => {
            let name = row.getAttribute('data-name').toLowerCase();
            let statusCell = row.querySelector('.status');
            let status = statusCell ? statusCell.textContent.toLowerCase() : '';

            // Only delete if status is not "restricted" and name matches search query
            if (name.includes(searchValue) && status  == "restricted") {
                row.remove();
                deleted = true;
            }
        });

        if (deleted == false) {
            alert("No active business found with that name.");
        }
    });
    //restrict a business
    document.getElementById('restrict-btn').addEventListener('click', function () {
        let searchValue = document.getElementById('search-bar').value.toLowerCase();
        let rows = document.querySelectorAll('#table-body tr');
        let restricted = false;

        rows.forEach(row => {
            let name = row.getAttribute('data-name').toLowerCase();
            if (name.includes(searchValue)) {
                let statusCell = row.querySelector('.status');
                statusCell.textContent = "Restricted";
                statusCell.style.color = "red"; // Change status color to indicate restriction
                restricted = true;
            }
        });

        if (!restricted) {
            alert("No business found with that name.");
        }
    });

    //unrestrict a business
    document.getElementById('unrestrict-btn').addEventListener('click', function () {
        let searchValue = document.getElementById('search-bar').value.toLowerCase();
        let rows = document.querySelectorAll('#table-body tr');
        let restricted = true;

        rows.forEach(row => {
            let name = row.getAttribute('data-name').toLowerCase();
            if (name.includes(searchValue)) {
                let statusCell = row.querySelector('.status');
                statusCell.textContent = "Active";
                statusCell.style.color = "black"; // Change status color to indicate restriction
                restricted = false;
            }
        });

        if (!!restricted) {
            alert("No business found with that name.");
        }
    });

    //adding businesses to the website
    document.getElementById('add-business-form').addEventListener('submit', function (e) {
        e.preventDefault();

        // Get form values
        const businessName = document.getElementById('business-name').value;
        const businessOwner = document.getElementById('business-owner').value;
        const businessId = document.getElementById('business-id').value;

        // Get the table body
        const tableBody = document.getElementById('table-body');

        // Create a new row with the form values
        const newRow = document.createElement('tr');

        //setting the attribute
        newRow.setAttribute('data-name', businessName.toLowerCase()); // Store business name in data-name (lowercase for easy search)

        // Create the columns (cells) for the new row
        const rowNumberCell = document.createElement('th');
        rowNumberCell.scope = 'row';
        rowNumberCell.textContent = tableBody.rows.length + 1;

        const nameCell = document.createElement('td');
        nameCell.textContent = businessName;

        const ownerCell = document.createElement('td');
        ownerCell.textContent = businessOwner;

        const idCell = document.createElement('td');
        idCell.textContent = businessId;

        const statusCell = document.createElement('td');
        statusCell.innerHTML = '<span class="status">Active</span>';

        // Append the cells to the new row
        newRow.appendChild(rowNumberCell);
        newRow.appendChild(nameCell);
        newRow.appendChild(ownerCell);
        newRow.appendChild(idCell);
        newRow.appendChild(statusCell);

        // Append the new row to the table body
        tableBody.appendChild(newRow);

        // Optionally, reset the form fields
        document.getElementById('business-name').value = '';
        document.getElementById('business-owner').value = '';
        document.getElementById('business-id').value = '';

        // Close the form (if you want it to collapse after submitting)
        const collapseElement = document.getElementById('add-business-form');
        const collapse = new bootstrap.Collapse(collapseElement, {toggle: true});

    });
    // Add event listener to each row for redirection
    document.querySelectorAll('#table-body tr').forEach(row => {
        row.addEventListener('click', function () {
            // Redirect to a new page with the business name as a URL parameter (optional)
            const businessName = row.getAttribute('data-name');
            window.location.href = `summary.html?business=${businessName}`;
        });
    });

</script>
</body>

</html>

