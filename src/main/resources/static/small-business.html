<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Business View</title>
    <link rel="stylesheet" href="style.css" >
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

</head>
<body>

    <div class="container">
        <!--aside section start -->
        <aside>
            <!--top section-->
            <div class="top">
                <div class="logo">
                    <h2>
                        <span class="danger">SSBM Admin</span>
                    </h2>
                </div>
            </div>
            <!--top section-->
            <div class="sidebar">

                <a href="/">
                    <span class="material-symbols-outlined"> grid_view </span>
                    <h3>Dashboard</h3>
                </a>
                <a href="/smallbusiness" >
                    <span class="material-symbols-outlined"> supervisor_account </span>
                    <h3>Business View</h3>
                </a>
                <a href="/student">
                    <span class="material-symbols-outlined"> person </span>
                    <h3>Student View</h3>
                </a>
                <a href="/analytics">
                    <span class="material-symbols-outlined"> monitoring </span>
                    <h3>Analytics</h3>
                </a>
                <a href="/usagedetails">
                    <span class="material-symbols-outlined"> email </span>
                    <h3>User Approvals</h3>
                </a>



                <a href="/login">
                    <span class="material-symbols-outlined"> logout  </span>
                    <h3>Logout</h3>
                </a>
            </div>
        </aside>

        <!--aside section end-->
        <main>
            <h1>Business View</h1>
            <div class="input-bar">
                <input type="text" id="search-bar" class="form-control" placeholder="Search Business by Name" aria-label="Search Business" >
            </div>

            <div id="buttons">
                <button type="button" class="btn btn-success" id="delete-btn">Delete Business</button>
                <button type="button" class="btn btn-success" id="restrict-btn">Restrict Business</button>
                <button type="button" class="btn btn-success" id="unrestrict-btn">Unrestrict Business</button>
            </div>


            <div class="custom-form-container">
                <form class="custom-form" id="business-form">
                    <h2>Add Business</h2>

                    <div class="form-row">
                        <label for="business-name">Business Name</label>
                        <input type="text" id="business-name" placeholder="Enter business name" required>
                    </div>
                    <div class="form-row">
                        <label for="business-providerID">Provider ID</label>
                        <input type="number" id="business-providerID" placeholder="i.e 201" required>
                    </div>
                    <div class="form-row">
                        <label for="business-category">Business Category</label>
                        <input type="text" id="business-category" placeholder="i.e cafe" required>
                    </div>
                    <div class="form-row">
                        <label for="business-description">Business Description</label>
                        <input type="text" id="business-description" placeholder="i.e cafe" required>
                    </div>
                    <div class="form-row">
                        <label for="business-address">Business Address</label>
                        <input type="text" id="business-address" placeholder="i.e 1712 Example Walker, NC, 27502" required>
                    </div>

                    <button type="submit" class="btn btn-success">Submit</button>
                </form>
            </div>



            <div class="recent_registration" id="businessTable"></div>


        </main>
        <!-- right section start -->
        <div class="right">
            <!-- start top -->

            <!-- end top -->
            <!--start recent updates -->
            <div class="recent_updates">
                <h2>Recent Update</h2>
                <div id="updatesContainer"></div>

            </div>


        </div>
        <!-- right section end -->
    </div>

</body>
<script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>

<script src="script.js"></script>
<script id="business-template" type="text/x-handlebars-template">

    <table>
        <thead>
        <tr>
            <th>Business ID</th>
            <th>Business Name</th>
            <th>Category</th>
            <th>Status</th>
            <th>Details</th>
        </tr>
        </thead>
        <tbody>
        {{#each businesses}}
        <tr data-business-id="{{businessId}}" class="{{#if (eq status 'restricted')}}restricted-row{{else}}unrestricted-row{{/if}}">

            <td>{{businessId}}</td>
            <td>{{businessName}}</td>
            <td>{{category}}</td>
            <td>{{status}}</td>
            <td>{{businessDescription}}</td>
        </tr>
        {{/each}}
        </tbody>
    </table>
</script>
<script id="event-template" type="text/x-handlebars-template">
    <div class="updates">
        {{#each events}}
        <div class="update">
            <div class="message">
                <p><b>{{eventName}}</b> </p>
                <p>{{eventDescription}}</p>
            </div>
        </div>
        {{/each}}
    </div>
</script>
<script>
    function getSelectedBusinessId() {
        const selectedRow = document.querySelector('.selected');
        if (selectedRow) {
            return selectedRow.querySelector('td:first-child').textContent; // Assuming businessId is in the first column
        } else {
            return null;
        }
    }

    function deleteBusiness() {
        const businessId = getSelectedBusinessId();
        if (!businessId) {
            alert("Please select a business to delete.");
            return;
        }

        fetch(`businesses/delete/${businessId}`, {
            method: 'DELETE'
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to delete business');
                }
                alert('Business deleted successfully');
                location.reload();
            })
            .catch(error => {
                console.error(error);
                alert("Something went wrong.");
            });
    }

    function restrictBusiness() {
        const businessId = getSelectedBusinessId();
        if (!businessId) {
            alert("Please select a business to restrict.");
            return;
        }

        fetch(`businesses/restrict/${businessId}`, {
            method: 'PUT'
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to restrict business');
                }

                // Update the status dynamically on success
                updateBusinessRow(businessId, 'restricted');
                alert('Business restricted successfully');
            })
            .catch(error => {
                console.error(error);
                alert("Something went wrong.");
            });
    }

    function unrestrictBusiness() {
        const businessId = getSelectedBusinessId();
        if (!businessId) {
            alert("Please select a business to unrestrict.");
            return;
        }

        fetch(`businesses/unrestrict/${businessId}`, {
            method: 'PUT'
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to unrestrict business');
                }

                // Update the status dynamically on success
                updateBusinessRow(businessId, 'unrestricted');
                alert('Business unrestricted successfully');
            })
            .catch(error => {
                console.error(error);
                alert("Something went wrong.");
            });
    }

    function updateBusinessRow(businessId, status) {
        // Find the table row by businessId
        const row = document.querySelector(`tr[data-business-id="${businessId}"]`);

        if (row) {
            // Update the status text in the table
            const statusColumn = row.querySelector('td:nth-child(4)'); // Assuming status is in the 4th column
            statusColumn.textContent = status;

            // Apply the color change
            if (status === 'restricted') {
                row.classList.add('restricted-row');
                row.classList.remove('unrestricted-row');
            } else {
                row.classList.add('unrestricted-row');
                row.classList.remove('restricted-row');
            }
        }
    }

</script>
</html>



