<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Student View</title>
    <link  rel="stylesheet" href="student.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
<div id="navbar-container"></div>
<div id="content">
    <div class="input-group mb-3">
        <input type="text" id="search-bar" class="form-control" placeholder="Search Student by Name" aria-label="Search Students">
    </div>

    <div id="buttons">
        <button type="button" class="btn btn-primary" id="delete-btn">Delete Student</button>
        <button type="button" class="btn btn-primary" id="expand-form-btn" data-bs-toggle="collapse" data-bs-target="#add-student-form">Add Student</button>
        <button type="button" class="btn btn-primary" id="restrict-btn">Restrict Student</button>
        <button type="button" class="btn btn-primary" id="unrestrict-btn">Unrestrict Student</button>

    </div>
    <div class="collapse" id="add-student-form">
        <form>
            <div class="form-group">
                <label for="student-first-name">First Name</label>
                <input type="text" class="form-control" id="student-first-name" placeholder="Enter first name">
            </div>
            <div class="form-group">
                <label for="student-last-name">Last Name</label>
                <input type="text" class="form-control" id="student-last-name" placeholder="Enter last name" required>
            </div>
            <div class="form-group">
                <label for="student-handle">Handle</label>
                <input type="text" class="form-control" id="student-handle" placeholder="@xyz" required>
            </div>
            <button type="submit" class="btn btn-success">Submit</button>
        </form>
    </div>
    <div id="list-students">
        <table class="table">
            <thead class="thead-dark">
            <tr>
                <th scope="col">#</th>
                <th scope="col">First</th>
                <th scope="col">Last</th>
                <th scope="col">Handle</th>
                <th scope="col">Status</th>
            </tr>
            </thead>
            <tbody id="table-body">
            <tr data-name="Mark">
                <th scope="row">1</th>
                <td>Mark</td>
                <td>Otto</td>
                <td>@mdo</td>
                <td><span class="status">Active</span></td>
            </tr>
            <tr data-name="Jacob">
                <th scope="row">2</th>
                <td>Jacob</td>
                <td>Thornton</td>
                <td>@fat
                <td><span class="status">Active</span></td>
            </tr>
            <tr data-name="Larry">
                <th scope="row">3</th>
                <td>Larry</td>
                <td>the Bird</td>
                <td>@twitter</td>
                <td><span class="status">Active</span></td>
            </tr>
            </tbody>
        </table>

    </div>


</div>

<!-- Bootstrap JS -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    fetch('navbar.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('navbar-container').innerHTML = data;
        })
        .catch(error => console.error('Error loading navbar:', error));  // To catch any fetch errors
    //for filtering table rows
    document.getElementById('search-bar').addEventListener('input', function () {
        let filter = this.value.toLowerCase();
        let rows = document.querySelectorAll('#table-body tr');
        rows.forEach(row => {
            let nameCell = row.cells[1].textContent.toLowerCase();
            if (nameCell.includes(filter)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });

    //deleting a student
    document.getElementById('delete-btn').addEventListener('click', function () {
        let searchValue = document.getElementById('search-bar').value.toLowerCase();
        let rows = document.querySelectorAll('#table-body tr');
        let deleted = false;

        rows.forEach(row => {
            let name = row.getAttribute('data-name').toLowerCase();
            let statusCell = row.querySelector('.status');
            let status = statusCell ? statusCell.textContent.toLowerCase() : '';

            // Only delete if status is not "restricted" and name matches search query
            if (name.includes(searchValue) && status  == "restricted") {
                row.remove();
                deleted = true;
            }
        });

        if (deleted == false) {
            alert("No restricted student found with that name.");
        }
    });
    //restrict a student
    document.getElementById('restrict-btn').addEventListener('click', function () {
        let searchValue = document.getElementById('search-bar').value.toLowerCase();
        let rows = document.querySelectorAll('#table-body tr');
        let restricted = false;

        rows.forEach(row => {
            let name = row.getAttribute('data-name').toLowerCase();
            if (name.includes(searchValue)) {
                let statusCell = row.querySelector('.status');
                statusCell.textContent = "Restricted";
                statusCell.style.color = "red"; // Change status color to indicate restriction
                restricted = true;
            }
        });

        if (!restricted) {
            alert("No student found with that name.");
        }
    });

    //unrestrict a business
    document.getElementById('unrestrict-btn').addEventListener('click', function () {
        let searchValue = document.getElementById('search-bar').value.toLowerCase();
        let rows = document.querySelectorAll('#table-body tr');
        let restricted = true;

        rows.forEach(row => {
            let name = row.getAttribute('data-name').toLowerCase();
            if (name.includes(searchValue)) {
                let statusCell = row.querySelector('.status');
                statusCell.textContent = "Active";
                statusCell.style.color = "black"; // Change status color to indicate restriction
                restricted = false;
            }
        });

        if (!!restricted) {
            alert("No student found with that name.");
        }
    });

    //adding businesses to the website
    document.getElementById('add-student-form').addEventListener('submit', function (e) {
        e.preventDefault();

        // Get form values
        const studentFirstName = document.getElementById('student-first-name').value;
        const studentLastName = document.getElementById('student-last-name').value;
        const studentHandle = document.getElementById('student-handle').value;

        // Get the table body
        const tableBody = document.getElementById('table-body');

        // Create a new row with the form values
        const newRow = document.createElement('tr');

        newRow.setAttribute('data-name', studentFirstName   .toLowerCase()); // Store business name in data-name (lowercase for easy search)

        // Create the columns (cells) for the new row
        const rowNumberCell = document.createElement('th');
        rowNumberCell.scope = 'row';
        rowNumberCell.textContent = tableBody.rows.length + 1;

        const firstNameCell = document.createElement('td');
        firstNameCell.textContent = studentFirstName;

        const lastNameCell = document.createElement('td');
        lastNameCell.textContent = studentLastName;

        const studentHandleCell = document.createElement('td');
        studentHandleCell.textContent = studentHandle;

        const statusCell = document.createElement('td');
        statusCell.innerHTML = '<span class="status">Active</span>';

        // Append the cells to the new row
        newRow.appendChild(rowNumberCell);
        newRow.appendChild(firstNameCell);
        newRow.appendChild(lastNameCell);
        newRow.appendChild(studentHandleCell);
        newRow.appendChild(statusCell);

        // Append the new row to the table body
        tableBody.appendChild(newRow);

        // Optionally, reset the form fields
        document.getElementById('student-first-name').value = '';
        document.getElementById('student-last-name').value = '';
        document.getElementById('student-handle').value = '';

        // Close the form (if you want it to collapse after submitting)
        const collapseElement = document.getElementById('add-student-form');
        const collapse = new bootstrap.Collapse(collapseElement, {toggle: true});

    });

</script>
</body>

</html>

